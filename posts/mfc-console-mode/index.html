<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>MFC 프로그램의 콘솔 실행 모드 추가 - JSYoo5B.Code();</title><meta name=Description content="Blog of JaeSang Yoo, the programmer."><meta property="og:title" content="MFC 프로그램의 콘솔 실행 모드 추가"><meta property="og:description" content="GUI 기반으로 작성한 프로그램은 직관적이지만, 해당 기능을 사용하기 위해 마우스를 사용해야 하며, 이로 인해 자동화하기 어렵다는 문제점이 있다. 물론 매크로 등을 활"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.jsyoo5b.dev/posts/mfc-console-mode/"><meta property="article:published_time" content="2020-09-14T21:03:17+09:00"><meta property="article:modified_time" content="2020-09-14T21:03:17+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MFC 프로그램의 콘솔 실행 모드 추가"><meta name=twitter:description content="GUI 기반으로 작성한 프로그램은 직관적이지만, 해당 기능을 사용하기 위해 마우스를 사용해야 하며, 이로 인해 자동화하기 어렵다는 문제점이 있다. 물론 매크로 등을 활"><meta name=application-name content="JSYoo5B.Code();"><meta name=apple-mobile-web-app-title content="JSYoo5B.Code();"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.jsyoo5b.dev/posts/mfc-console-mode/><link rel=prev href=https://blog.jsyoo5b.dev/posts/project-whitecat/chap0-changing-home-network/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"MFC 프로그램의 콘솔 실행 모드 추가","inLanguage":"ko","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.jsyoo5b.dev\/posts\/mfc-console-mode\/"},"genre":"posts","keywords":"MFC, GUI","wordcount":5025,"url":"https:\/\/blog.jsyoo5b.dev\/posts\/mfc-console-mode\/","datePublished":"2020-09-14T21:03:17+09:00","dateModified":"2020-09-14T21:03:17+09:00","publisher":{"@type":"Organization","name":"유재상"},"author":{"@type":"Person","name":"유재상"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=JSYoo5B.Code();>JSYoo5B.Code();</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>소개 </a><a class=menu-item href=/posts/>블로그 </a><a class=menu-item href=/categories/>카테고리 </a><a class=menu-item href=/tags/>태그 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="언어 변경">한국어<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/posts/mfc-console-mode/ selected>한국어</option></select>
</a><a href=javascript:void(0); class="menu-item theme-switch" title="테마 변경"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=JSYoo5B.Code();>JSYoo5B.Code();</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/>소개</a><a class=menu-item href=/posts/>블로그</a><a class=menu-item href=/categories/>카테고리</a><a class=menu-item href=/tags/>태그</a><a href=javascript:void(0); class="menu-item theme-switch" title="테마 변경">
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title="언어 변경">한국어<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/posts/mfc-console-mode/ selected>한국어</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>목차</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">MFC 프로그램의 콘솔 실행 모드 추가</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>유재상</a></span>&nbsp;<span class=post-category>분류: <a href=/categories/%EA%B0%9C%EB%B0%9C/><i class="far fa-folder fa-fw"></i>개발</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-09-14>2020-09-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;5025 단어&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;읽는데 약 11분&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>목차</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#목표>목표</a></li><li><a href=#진단>진단</a></li><li><a href=#console-실행-모드-추가하기>Console 실행 모드 추가하기</a></li><li><a href=#프로그램을-실행시킨-shell과-stdio-연결>프로그램을 실행시킨 shell과 stdio 연결</a></li><li><a href=#임의의-exit-code로-종료시키기>임의의 Exit Code로 종료시키기</a></li><li><a href=#실행-인자-사용을-위한-추가-설명>실행 인자 사용을 위한 추가 설명</a></li><li><a href=#command-prompt-명령어-설명>Command Prompt 명령어 설명</a></li><li><a href=#해설>해설</a><ul><li><a href=#다른-gui-framework에서의-진입점-main-함수>다른 GUI framework에서의 진입점 (main 함수)</a></li></ul></li><li><a href=#참고-링크>참고 링크</a></li></ul></nav></div></div><div class=content id=content><p>GUI 기반으로 작성한 프로그램은 직관적이지만, 해당 기능을 사용하기 위해 마우스를 사용해야 하며, 이로 인해 자동화하기 어렵다는 문제점이 있다. 물론 매크로 등을 활용할 수 있지만, 사람이 직접 수행하지 않을 뿐, 결국 프로그램으로 마우스 클릭 등을 반복하는 것이다.</p><p>GUI 기반으로 개발된 파일을 변환해주는 프로그램들을 CI/CD 과정에 사용하려 한다고 가정해보자.</p><ol><li>GUI를 실행하기 위한 Desktop Environment가 없는 Container/Build server일 수 있다.</li><li>GUI가 있는 환경이라도, 해당 환경에 맞춰 매크로를 기록해야 한다.</li><li>매크로를 사용해도 Build server에 RDP 등으로 접속 시, 해상도 변경, 좌표 변경 등 이슈가 발생한다.</li><li>여러 GUI 기반 프로그램들을 실행할 때, 마우스 위치가 점유 자원으로서 병렬성을 방해한다.</li><li>해당 프로그램의 실행 결과도 GUI로 나타나므로, 이를 쉽게 확인할 수 없다.</li></ol><p>위의 상황은 극단적으로 가정한 것이지만, 최소 1개 이상 실제 문제가 될 것이라 예상한다.</p><h2 id=목표>목표</h2><ol><li>Window Manager(Windows Explorer, Gnome 등)나 Shell(Bash, Command Prompt 등)에서 실행 시, GUI 환경으로 실행</li><li>Shell에서 실행할 때 특정 인자를 입력하면(혹은 Windows Manager의 Shortcut에 인자 추가) GUI를 띄우지 않고,
해당 인자에 따라 기능을 수행한 뒤 종료.</li><li>필요에 따라 진행 과정에 대한 Log를 출력한다.</li><li>해당 프로그램의 성공/실패 여부에 따라 확인할 수 있게 Error code를 반환하며 종료한다.</li></ol><p>위의 목표를 개발자 기준의 요구사항으로 해석하면 아래와 같다.</p><ol><li>기존의 GUI 실행에 관련된 코드를 뒤엎지 않고 기능을 추가해야 한다.</li><li>해당 프로그램 실행의 인자를 읽고, 특정 조건 시 GUI를 실행시키는 함수를 호출하지 않아야 한다.</li><li>stdio (특히 stdout, stderr)가 해당 프로그램을 실행시킨 shell과 연결되어 있어야 한다.</li><li>GUI를 실행시키지 않은 상태에서 원하는 exit code로 프로그램을 종료시켜야 한다.</li><li><del>MFC같이 안 좋은 GUI framework에서 개발해야 한다.</del></li></ol><h2 id=진단>진단</h2><p>이제 MFC 프로그램을 작성하고, Shell에서 실행시켜보자. MFC 응용 프로그램 프로젝트를 ConsoleGuiTool로 가정하겠다. (대화 상자 기반으로 작성하였으나, 다른 종류도 크게 문제되지 않는다.) 빌드하고 Command Prompt에서 실행시켜보면 아래 스크린샷과 같은 상황을 확인할 수 있을 것이다.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=Run_in_cmd_vanilla.png data-srcset="/posts/mfc-console-mode/Run_in_cmd_vanilla.png, Run_in_cmd_vanilla.png 1.5x, /posts/mfc-console-mode/Run_in_cmd_vanilla.png 2x" data-sizes=auto alt=/posts/mfc-console-mode/Run_in_cmd_vanilla.png title="GUI 구동 시, Command Prompt와의 연결이 끊어진다"></p><p>분명 해당 프로그램이 종료되지 않았음에도 Shell과의 연결이 끊어졌다. 요구사항 3, 4의 상황에서 문제가 생길 수 있다. (자세한 설명은 <a href=#command-prompt-%eb%aa%85%eb%a0%b9%ec%96%b4-%ec%84%a4%eb%aa%85 rel>Command Prompt 명령어 설명</a>에서 다루도록 한다.)</p><h2 id=console-실행-모드-추가하기>Console 실행 모드 추가하기</h2><p>일단 수정해야 할 파일은 현재 MFC 프로그램의 진입점 부분이다. CWinApp을 상속하고 있는 클래스의 소스 코드를 찾자. (특별히 이름을 변경하지 않았다면, 프로젝트 이름과 같은 *.h, *.cpp일 것이다.)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>
<span style=color:#75715e>// ConsoleGuiTool.h : main header file for the PROJECT_NAME application
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#75715e>#pragma once
</span><span style=color:#75715e></span>
<span style=color:#75715e>#ifndef __AFXWIN_H__
</span><span style=color:#75715e></span>	<span style=color:#75715e>#error &#34;include &#39;stdafx.h&#39; before including this file for PCH&#34;
</span><span style=color:#75715e>#endif
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;resource.h&#34;		// main symbols</span><span style=color:#75715e>
</span><span style=color:#75715e></span>

<span style=color:#75715e>// CConsoleGuiToolApp:
</span><span style=color:#75715e>// See ConsoleGuiTool.cpp for the implementation of this class
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CConsoleGuiToolApp</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> CWinApp
{
<span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
	CConsoleGuiToolApp();

<span style=color:#75715e>// Overrides
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
	<span style=color:#66d9ef>virtual</span> BOOL InitInstance();

<span style=color:#75715e>// Implementation
</span><span style=color:#75715e></span>
	DECLARE_MESSAGE_MAP()
};

<span style=color:#66d9ef>extern</span> CConsoleGuiToolApp theApp;
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">88
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">89
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">90
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">91
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">92
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">93
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">94
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">95
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">96
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">97
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>
<span style=color:#75715e>// ConsoleGuiTool.cpp : Defines the class behaviors for the application.
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;stdafx.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;ConsoleGuiTool.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;ConsoleGuiToolDlg.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#ifdef _DEBUG
</span><span style=color:#75715e>#define new DEBUG_NEW
</span><span style=color:#75715e>#endif
</span><span style=color:#75715e></span>

<span style=color:#75715e>// CConsoleGuiToolApp
</span><span style=color:#75715e></span>
BEGIN_MESSAGE_MAP(CConsoleGuiToolApp, CWinApp)
	ON_COMMAND(ID_HELP, <span style=color:#f92672>&amp;</span>CWinApp<span style=color:#f92672>::</span>OnHelp)
END_MESSAGE_MAP()


<span style=color:#75715e>// CConsoleGuiToolApp construction
</span><span style=color:#75715e></span>
CConsoleGuiToolApp<span style=color:#f92672>::</span>CConsoleGuiToolApp()
{
	<span style=color:#75715e>// TODO: add construction code here,
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Place all significant initialization in InitInstance
</span><span style=color:#75715e></span>}


<span style=color:#75715e>// The one and only CConsoleGuiToolApp object
</span><span style=color:#75715e></span>
CConsoleGuiToolApp theApp;


<span style=color:#75715e>// CConsoleGuiToolApp initialization
</span><span style=color:#75715e></span>
BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>InitInstance()
{
	<span style=color:#75715e>// InitCommonControlsEx() is required on Windows XP if an application
</span><span style=color:#75715e></span>	<span style=color:#75715e>// manifest specifies use of ComCtl32.dll version 6 or later to enable
</span><span style=color:#75715e></span>	<span style=color:#75715e>// visual styles.  Otherwise, any window creation will fail.
</span><span style=color:#75715e></span>	INITCOMMONCONTROLSEX InitCtrls;
	InitCtrls.dwSize <span style=color:#f92672>=</span> <span style=color:#66d9ef>sizeof</span>(InitCtrls);
	<span style=color:#75715e>// Set this to include all the common control classes you want to use
</span><span style=color:#75715e></span>	<span style=color:#75715e>// in your application.
</span><span style=color:#75715e></span>	InitCtrls.dwICC <span style=color:#f92672>=</span> ICC_WIN95_CLASSES;
	InitCommonControlsEx(<span style=color:#f92672>&amp;</span>InitCtrls);

	CWinApp<span style=color:#f92672>::</span>InitInstance();


	<span style=color:#75715e>// Create the shell manager, in case the dialog contains
</span><span style=color:#75715e></span>	<span style=color:#75715e>// any shell tree view or shell list view controls.
</span><span style=color:#75715e></span>	CShellManager <span style=color:#f92672>*</span>pShellManager <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CShellManager;

	<span style=color:#75715e>// Activate &#34;Windows Native&#34; visual manager for enabling themes in MFC controls
</span><span style=color:#75715e></span>	CMFCVisualManager<span style=color:#f92672>::</span>SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerWindows));

	<span style=color:#75715e>// Standard initialization
</span><span style=color:#75715e></span>	<span style=color:#75715e>// If you are not using these features and wish to reduce the size
</span><span style=color:#75715e></span>	<span style=color:#75715e>// of your final executable, you should remove from the following
</span><span style=color:#75715e></span>	<span style=color:#75715e>// the specific initialization routines you do not need
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Change the registry key under which our settings are stored
</span><span style=color:#75715e></span>	<span style=color:#75715e>// TODO: You should modify this string to be something appropriate
</span><span style=color:#75715e></span>	<span style=color:#75715e>// such as the name of your company or organization
</span><span style=color:#75715e></span>	SetRegistryKey(_T(<span style=color:#e6db74>&#34;Local AppWizard-Generated Applications&#34;</span>));

	CConsoleGuiToolDlg dlg;
	m_pMainWnd <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>dlg;
	INT_PTR nResponse <span style=color:#f92672>=</span> dlg.DoModal();
	<span style=color:#66d9ef>if</span> (nResponse <span style=color:#f92672>==</span> IDOK)
	{
		<span style=color:#75715e>// TODO: Place code here to handle when the dialog is
</span><span style=color:#75715e></span>		<span style=color:#75715e>//  dismissed with OK
</span><span style=color:#75715e></span>	}
	<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (nResponse <span style=color:#f92672>==</span> IDCANCEL)
	{
		<span style=color:#75715e>// TODO: Place code here to handle when the dialog is
</span><span style=color:#75715e></span>		<span style=color:#75715e>//  dismissed with Cancel
</span><span style=color:#75715e></span>	}
	<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (nResponse <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
	{
		TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: dialog creation failed, so application is terminating unexpectedly.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
		TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: if you are using MFC controls on the dialog, you cannot #define _AFX_NO_MFC_CONTROLS_IN_DIALOGS.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
	}

	<span style=color:#75715e>// Delete the shell manager created above.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (pShellManager <span style=color:#f92672>!=</span> NULL)
	{
		<span style=color:#66d9ef>delete</span> pShellManager;
	}

	<span style=color:#75715e>// Since the dialog has been closed, return FALSE so that we exit the
</span><span style=color:#75715e></span>	<span style=color:#75715e>//  application, rather than start the application&#39;s message pump.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> FALSE;
}

</code></pre></td></tr></table></div></div><p>해당 class에 기존 GUI환경의 init을 담당할 InitGuiWindow()와 콘솔모드로 실행할 RunConsole() 함수를 추가한다. 이후 기존의 InitInstance()함수를 InitGuiWindow()로 교체하고, 새로운 InitInstance()를 아래와 같이 작성한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>
<span style=color:#75715e>// ConsoleGuiTool.h : main header file for the PROJECT_NAME application
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#75715e>#pragma once
</span><span style=color:#75715e></span>
<span style=color:#75715e>#ifndef __AFXWIN_H__
</span><span style=color:#75715e></span>	<span style=color:#75715e>#error &#34;include &#39;stdafx.h&#39; before including this file for PCH&#34;
</span><span style=color:#75715e>#endif
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;resource.h&#34;		// main symbols</span><span style=color:#75715e>
</span><span style=color:#75715e></span>

<span style=color:#75715e>// CConsoleGuiToolApp:
</span><span style=color:#75715e>// See ConsoleGuiTool.cpp for the implementation of this class
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CConsoleGuiToolApp</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>public</span> CWinApp
{
<span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
	CConsoleGuiToolApp();

<span style=color:#75715e>// Overrides
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
	<span style=color:#66d9ef>virtual</span> BOOL InitInstance();

<span style=color:#75715e>// Implementation
</span><span style=color:#75715e></span>
	DECLARE_MESSAGE_MAP()
<span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>	BOOL InitGuiWindow();
</span><span style=display:block;width:100%;background-color:#3c3d38>	BOOL <span style=color:#a6e22e>RunConsole</span>();
</span>};

<span style=color:#66d9ef>extern</span> CConsoleGuiToolApp theApp;
</code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>
<span style=color:#75715e>// ConsoleGuiTool.cpp : Defines the class behaviors for the application.
</span><span style=color:#75715e>//
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;stdafx.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;ConsoleGuiTool.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;ConsoleGuiToolDlg.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#ifdef _DEBUG
</span><span style=color:#75715e>#define new DEBUG_NEW
</span><span style=color:#75715e>#endif
</span><span style=color:#75715e></span>

<span style=color:#75715e>// CConsoleGuiToolApp
</span><span style=color:#75715e></span>
BEGIN_MESSAGE_MAP(CConsoleGuiToolApp, CWinApp)
	ON_COMMAND(ID_HELP, <span style=color:#f92672>&amp;</span>CWinApp<span style=color:#f92672>::</span>OnHelp)
END_MESSAGE_MAP()


<span style=color:#75715e>// CConsoleGuiToolApp construction
</span><span style=color:#75715e></span>
CConsoleGuiToolApp<span style=color:#f92672>::</span>CConsoleGuiToolApp()
{
	<span style=color:#75715e>// TODO: add construction code here,
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Place all significant initialization in InitInstance
</span><span style=color:#75715e></span>}


<span style=color:#75715e>// The one and only CConsoleGuiToolApp object
</span><span style=color:#75715e></span>
CConsoleGuiToolApp theApp;


<span style=color:#75715e>// CConsoleGuiToolApp initialization
</span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e></span>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>InitInstance()
</span><span style=display:block;width:100%;background-color:#3c3d38>{
</span><span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>int</span> nArgCnt <span style=color:#f92672>=</span> __argc;
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>if</span> (nArgCnt <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
</span><span style=display:block;width:100%;background-color:#3c3d38>	{
</span><span style=display:block;width:100%;background-color:#3c3d38>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>InitGuiWindow</span>();
</span><span style=display:block;width:100%;background-color:#3c3d38>	}
</span><span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>else</span>
</span><span style=display:block;width:100%;background-color:#3c3d38>	{
</span><span style=display:block;width:100%;background-color:#3c3d38>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>RunConsole</span>();
</span><span style=display:block;width:100%;background-color:#3c3d38>	}
</span><span style=display:block;width:100%;background-color:#3c3d38>}
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>InitGuiWindow()
</span>{
	<span style=color:#75715e>// InitCommonControlsEx() is required on Windows XP if an application
</span><span style=color:#75715e></span>	<span style=color:#75715e>// manifest specifies use of ComCtl32.dll version 6 or later to enable
</span><span style=color:#75715e></span>	<span style=color:#75715e>// visual styles.  Otherwise, any window creation will fail.
</span><span style=color:#75715e></span>	INITCOMMONCONTROLSEX InitCtrls;
	InitCtrls.dwSize <span style=color:#f92672>=</span> <span style=color:#66d9ef>sizeof</span>(InitCtrls);
	<span style=color:#75715e>// Set this to include all the common control classes you want to use
</span><span style=color:#75715e></span>	<span style=color:#75715e>// in your application.
</span><span style=color:#75715e></span>	InitCtrls.dwICC <span style=color:#f92672>=</span> ICC_WIN95_CLASSES;
	InitCommonControlsEx(<span style=color:#f92672>&amp;</span>InitCtrls);

	CWinApp<span style=color:#f92672>::</span>InitInstance();


	<span style=color:#75715e>// Create the shell manager, in case the dialog contains
</span><span style=color:#75715e></span>	<span style=color:#75715e>// any shell tree view or shell list view controls.
</span><span style=color:#75715e></span>	CShellManager <span style=color:#f92672>*</span>pShellManager <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CShellManager;

	<span style=color:#75715e>// Activate &#34;Windows Native&#34; visual manager for enabling themes in MFC controls
</span><span style=color:#75715e></span>	CMFCVisualManager<span style=color:#f92672>::</span>SetDefaultManager(RUNTIME_CLASS(CMFCVisualManagerWindows));

	<span style=color:#75715e>// Standard initialization
</span><span style=color:#75715e></span>	<span style=color:#75715e>// If you are not using these features and wish to reduce the size
</span><span style=color:#75715e></span>	<span style=color:#75715e>// of your final executable, you should remove from the following
</span><span style=color:#75715e></span>	<span style=color:#75715e>// the specific initialization routines you do not need
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Change the registry key under which our settings are stored
</span><span style=color:#75715e></span>	<span style=color:#75715e>// TODO: You should modify this string to be something appropriate
</span><span style=color:#75715e></span>	<span style=color:#75715e>// such as the name of your company or organization
</span><span style=color:#75715e></span>	SetRegistryKey(_T(<span style=color:#e6db74>&#34;Local AppWizard-Generated Applications&#34;</span>));

	CConsoleGuiToolDlg dlg;
	m_pMainWnd <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>dlg;
	INT_PTR nResponse <span style=color:#f92672>=</span> dlg.DoModal();
	<span style=color:#66d9ef>if</span> (nResponse <span style=color:#f92672>==</span> IDOK)
	{
		<span style=color:#75715e>// TODO: Place code here to handle when the dialog is
</span><span style=color:#75715e></span>		<span style=color:#75715e>//  dismissed with OK
</span><span style=color:#75715e></span>	}
	<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (nResponse <span style=color:#f92672>==</span> IDCANCEL)
	{
		<span style=color:#75715e>// TODO: Place code here to handle when the dialog is
</span><span style=color:#75715e></span>		<span style=color:#75715e>//  dismissed with Cancel
</span><span style=color:#75715e></span>	}
	<span style=color:#66d9ef>else</span> <span style=color:#a6e22e>if</span> (nResponse <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
	{
		TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: dialog creation failed, so application is terminating unexpectedly.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
		TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: if you are using MFC controls on the dialog, you cannot #define _AFX_NO_MFC_CONTROLS_IN_DIALOGS.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
	}

	<span style=color:#75715e>// Delete the shell manager created above.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (pShellManager <span style=color:#f92672>!=</span> NULL)
	{
		<span style=color:#66d9ef>delete</span> pShellManager;
	}

	<span style=color:#75715e>// Since the dialog has been closed, return FALSE so that we exit the
</span><span style=color:#75715e></span>	<span style=color:#75715e>//  application, rather than start the application&#39;s message pump.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> FALSE;
}


<span style=display:block;width:100%;background-color:#3c3d38>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>RunConsole()
</span><span style=display:block;width:100%;background-color:#3c3d38>{
</span><span style=display:block;width:100%;background-color:#3c3d38>	printf(<span style=color:#e6db74>&#34;Program is running in console mode</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span><span style=display:block;width:100%;background-color:#3c3d38>	Sleep(<span style=color:#ae81ff>5000</span>);
</span><span style=display:block;width:100%;background-color:#3c3d38>	printf(<span style=color:#e6db74>&#34;It seems program did some job, 5 second passed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>return</span> FALSE;
</span><span style=display:block;width:100%;background-color:#3c3d38>}
</span></code></pre></td></tr></table></div></div><p>일단 콘솔 모드 진입 조건은 실행파일 뒤에 인자가 하나라도 붙는 것으로 설정했다. 콘솔 모드 진입시, 콘솔 모드로 실행된다는 메시지를 출력하고, 5초 이후 무언가 완료되었다고 하고 종료되게 설정하였다. 빌드하고 Command Prompt에서 실행시켜보면 아래 스크린샷과 같은 상황을 확인할 수 있을 것이다.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=Run_in_cmd_stdio_not_attached.png data-srcset="/posts/mfc-console-mode/Run_in_cmd_stdio_not_attached.png, Run_in_cmd_stdio_not_attached.png 1.5x, /posts/mfc-console-mode/Run_in_cmd_stdio_not_attached.png 2x" data-sizes=auto alt=/posts/mfc-console-mode/Run_in_cmd_stdio_not_attached.png title="콘솔 모드로 실행 시 5초 후 종료됨. (메시지 출력 안됨), 기존 GUI 구동은 잘 됨"></p><p>일단 실행 인자 옵션에 따라 기존 GUI 구동을 유지한 상태에서, 콘솔 모드 실행에 성공했다. 하지만 printf를 통한 메시지 출력이 되지 않는 것을 확인할 수 있다.</p><h2 id=프로그램을-실행시킨-shell과-stdio-연결>프로그램을 실행시킨 shell과 stdio 연결</h2><p>해당 증상의 원인은 MFC 프로그램 실행 시, stdio가 기존 shell에서 떨어지기 때문이다. MFC 프로그램을 실행시킨 부모 프로세스(Command Prompt 혹은 PowerShell)의 stdio와 연결해야한다. 기존의 RunConsole() 함수를 아래와 같이 수정한다. (코드 상단에 #include &lt;iostream>을 해야한다.)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>RunConsole()
{
<span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>if</span> (AttachConsole(ATTACH_PARENT_PROCESS))
</span><span style=display:block;width:100%;background-color:#3c3d38>	{
</span><span style=display:block;width:100%;background-color:#3c3d38>		FILE <span style=color:#f92672>*</span>pfStdin;
</span><span style=display:block;width:100%;background-color:#3c3d38>		FILE <span style=color:#f92672>*</span>pfStdout;
</span><span style=display:block;width:100%;background-color:#3c3d38>		FILE <span style=color:#f92672>*</span>pfStderr;
</span><span style=display:block;width:100%;background-color:#3c3d38>		freopen_s(<span style=color:#f92672>&amp;</span>pfStdin, <span style=color:#e6db74>&#34;CONIN$&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>, stdin);
</span><span style=display:block;width:100%;background-color:#3c3d38>		freopen_s(<span style=color:#f92672>&amp;</span>pfStdout, <span style=color:#e6db74>&#34;CONOUT$&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>, stdout);
</span><span style=display:block;width:100%;background-color:#3c3d38>		freopen_s(<span style=color:#f92672>&amp;</span>pfStderr, <span style=color:#e6db74>&#34;CONOUT$&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>, stderr);
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>		std<span style=color:#f92672>::</span>cin.clear();
</span><span style=display:block;width:100%;background-color:#3c3d38>		std<span style=color:#f92672>::</span>cout.clear();
</span><span style=display:block;width:100%;background-color:#3c3d38>		std<span style=color:#f92672>::</span>cerr.clear();
</span><span style=display:block;width:100%;background-color:#3c3d38>	}
</span>
	printf(<span style=color:#e6db74>&#34;Program is running in console mode</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
	Sleep(<span style=color:#ae81ff>5000</span>);
	printf(<span style=color:#e6db74>&#34;It seems program did some job, 5 second passed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);

	<span style=color:#66d9ef>return</span> FALSE;
}
</code></pre></td></tr></table></div></div><p>L116~128의 내용은 부모 프로세스의 콘솔에 연결하고 stdin, stdout, stderr를 다시 여는 작업을 수행한다.</p><h2 id=임의의-exit-code로-종료시키기>임의의 Exit Code로 종료시키기</h2><p>원칙적으로는 main() 함수의 return값으로 exit code를 보내는 것이 정석이나, 우리가 현재 수정 가능한 코드 범위에서는 main() 함수를 수정할 수 없기 때문에 차선책인 <a href=https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/exit-exit-exit target=_blank rel="noopener noreffer">exit()</a> 함수를 사용하면 된다.</p><p>stdin의 연결 상태를 확인할 겸, 아래와 같이 RunConsole() 함수를 수정한다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>RunConsole()
{
<span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#66d9ef>int</span> nExitCode;
</span>
	<span style=color:#66d9ef>if</span> (AttachConsole(ATTACH_PARENT_PROCESS))
	{
		FILE <span style=color:#f92672>*</span>pfStdin;
		FILE <span style=color:#f92672>*</span>pfStdout;
		FILE <span style=color:#f92672>*</span>pfStderr;
		freopen_s(<span style=color:#f92672>&amp;</span>pfStdin, <span style=color:#e6db74>&#34;CONIN$&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>, stdin);
		freopen_s(<span style=color:#f92672>&amp;</span>pfStdout, <span style=color:#e6db74>&#34;CONOUT$&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>, stdout);
		freopen_s(<span style=color:#f92672>&amp;</span>pfStderr, <span style=color:#e6db74>&#34;CONOUT$&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>, stderr);

		std<span style=color:#f92672>::</span>cin.clear();
		std<span style=color:#f92672>::</span>cout.clear();
		std<span style=color:#f92672>::</span>cerr.clear();
	}

	printf(<span style=color:#e6db74>&#34;Program is running in console mode</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
	Sleep(<span style=color:#ae81ff>5000</span>);
	printf(<span style=color:#e6db74>&#34;It seems program did some job, 5 second passed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
<span style=display:block;width:100%;background-color:#3c3d38>	printf(<span style=color:#e6db74>&#34;Enter exit code to get: &#34;</span>);
</span><span style=display:block;width:100%;background-color:#3c3d38>	std<span style=color:#f92672>::</span>cin <span style=color:#f92672>&gt;&gt;</span> nExitCode;
</span><span style=display:block;width:100%;background-color:#3c3d38>
</span><span style=display:block;width:100%;background-color:#3c3d38>	exit(nExitCode);
</span>	<span style=color:#66d9ef>return</span> FALSE;
}
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=Run_in_cmd_stdio_attached.png data-srcset="/posts/mfc-console-mode/Run_in_cmd_stdio_attached.png, Run_in_cmd_stdio_attached.png 1.5x, /posts/mfc-console-mode/Run_in_cmd_stdio_attached.png 2x" data-sizes=auto alt=/posts/mfc-console-mode/Run_in_cmd_stdio_attached.png title="콘솔 모드에서 stdio 동작 확인, 원하는 대로 exit code 반환"></p><p>위 목표를 모두 달성했다. 이제 실행인자를 잘 입력 받았는지 확인하고, 이를 비교하기만 하면 된다.</p><h2 id=실행-인자-사용을-위한-추가-설명>실행 인자 사용을 위한 추가 설명</h2><p>이전의 설명은 CWinApp::InitInstance() 메서드를 수정하여 GUI를 띄우지 않고 콘솔에서 입출력을 수행하는 부분을 설명했다. 실행 인자를 입력받는 방법은 <a href=https://docs.microsoft.com/en-us/cpp/c-runtime-library/argc-argv-wargv target=_blank rel="noopener noreffer">__argc, __argv, __wargv</a> 전역변수를 활용한다. 해당 변수는 stdlib.h에서 제공하며, Microsoft에서만 제공하는 확장 기능이다. (C,C++ 표준이 아님) (Multi-Byte Character Set으로 빌드한 경우 __argv를, Unicode Character Set으로 빌드한 경우 __wargv를 사용)</p><p>이외에도 <a href=https://docs.microsoft.com/en-us/windows/win32/api/processenv/nf-processenv-getcommandlinea target=_blank rel="noopener noreffer">GetCommandLine()</a>, <a href=https://docs.microsoft.com/en-us/cpp/mfc/reference/cwinapp-class#parsecommandline target=_blank rel="noopener noreffer">CWinApp::ParseCommandLine()</a> 등의 방법으로도 실행 인자를 얻을 수 있다. 이 중 ParseCommandLine()에서 사용하는 <a href=https://docs.microsoft.com/en-us/cpp/mfc/reference/ccommandlineinfo-class target=_blank rel="noopener noreffer">CCommandLineInfo</a>는 Windows에서 제공하는 기능의 일부를 해석해준다.</p><h2 id=command-prompt-명령어-설명>Command Prompt 명령어 설명</h2><p>사실 Windows에서 제공하는 Command Prompt, PowerShell에서 GUI를 사용하는 프로그램을 실행시키면 자동으로 해당 shell에서 detach하게 되어있다. 현재 수정한 방식은 GUI를 화면에 출력하기 전에 기능을 수행하고 종료시킨 것이므로, 똑같이 shell에서 detach하게 되어있다.</p><p>Command Prompt에서 콘솔 모드 사용을 위해서는 아래와 같은 옵션을 고려해야 한다.</p><blockquote><p>start /wait &lt;PROGRAM></p></blockquote><p><a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/start target=_blank rel="noopener noreffer">&lt;PROGRAM>을 실행시키고, 해당 &lt;PROGRAM>이 종료될 때 까지 기다린다.</a></p><blockquote><p>cmd /v:on /c &ldquo;echo !time! &mldr;</p></blockquote><p>Batch file을 실행할 때, 환경변수 등은 %VAR%를 통해 그 값으로 치환할 수 있다. 하지만 위 예시와 같이 프로그램의 실행 시간을 측정하기 위해 한 명령행 안에 %VAR%로 넣을 경우, 즉시 치환된다.
(!time! 대신 %time%로 입력 시, 실제 소요시간과 관계없이 같은 시간이 나타난다.) <a href=https://en.wikipedia.org/wiki/Batch_file#Escaped_characters_in_strings target=_blank rel="noopener noreffer">해당 변수에 접근하는 순간 치환되길 원한다면, 위와 같이 !VAR!로 표기해야 한다.</a> 또한 위와 같은 delayed environment variable expansion을 사용하려면 현재 콘솔에 옵션을 설정하거나 cmd로 실행시킬 때, /v:on 옵션을 주고 실행시켜야 한다.</p><h2 id=해설>해설</h2><p>C/C++로 작성한 프로그램의 기본 진입점은 main()함수이다. main()함수의 매개변수로 int argc, char** argv를 사용하여 실행 인자를 프로그램 내에서 확인할 수 있다.</p><p>하지만 MFC로 프로젝트를 생성할 경우, main()함수를 개발자가 직접 편집할 수 없다. 이전의 코드에서 봤던 것 처럼 개발자가 수정 가능한 프로그램의 최초 진입 지점은 CWinApp::InitInstance() 메서드이다.</p><p>main()함수 역할을 수행하는 WinAPI에서 제공하는 진입점은 <a href=https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-winmain target=_blank rel="noopener noreffer">_tWinMain()</a> 함수이다. MFC에서 작성된 _tWinMain()함수의 정의는 VC\atlmfc\src\mfc\appmodul.cpp에서 확인할 수 있다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// This is a part of the Microsoft Foundation Classes C++ library.
</span><span style=color:#75715e>// Copyright (C) Microsoft Corporation
</span><span style=color:#75715e>// All rights reserved.
</span><span style=color:#75715e>//
</span><span style=color:#75715e>// This source code is only intended as a supplement to the
</span><span style=color:#75715e>// Microsoft Foundation Classes Reference and related
</span><span style=color:#75715e>// electronic documentation provided with the library.
</span><span style=color:#75715e>// See these sources for detailed information regarding the
</span><span style=color:#75715e>// Microsoft Foundation Classes product.
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;stdafx.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;sal.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////
</span><span style=color:#75715e>// export WinMain to force linkage to this module
</span><span style=color:#75715e></span><span style=color:#66d9ef>extern</span> <span style=color:#66d9ef>int</span> AFXAPI <span style=color:#a6e22e>AfxWinMain</span>(HINSTANCE hInstance, HINSTANCE hPrevInstance,
	_In_ LPTSTR lpCmdLine, <span style=color:#66d9ef>int</span> nCmdShow);

<span style=display:block;width:100%;background-color:#3c3d38><span style=color:#66d9ef>extern</span> <span style=color:#e6db74>&#34;C&#34;</span> <span style=color:#66d9ef>int</span> WINAPI
</span><span style=display:block;width:100%;background-color:#3c3d38>_tWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,
</span><span style=display:block;width:100%;background-color:#3c3d38>	_In_ LPTSTR lpCmdLine, <span style=color:#66d9ef>int</span> nCmdShow)
</span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e>#pragma warning(suppress: 4985)
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e></span>{
</span><span style=display:block;width:100%;background-color:#3c3d38>	<span style=color:#75715e>// call shared/exported WinMain
</span></span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>AfxWinMain</span>(hInstance, hPrevInstance, lpCmdLine, nCmdShow);
</span><span style=display:block;width:100%;background-color:#3c3d38>}
</span>
<span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////
</span><span style=color:#75715e>// initialize app state such that it points to this module&#39;s core state
</span><span style=color:#75715e></span>
BOOL AFXAPI <span style=color:#a6e22e>AfxInitialize</span>(BOOL bDLL, DWORD dwVersion)
{
	AFX_MODULE_STATE<span style=color:#f92672>*</span> pModuleState <span style=color:#f92672>=</span> AfxGetModuleState();
	pModuleState<span style=color:#f92672>-&gt;</span>m_bDLL <span style=color:#f92672>=</span> (BYTE)bDLL;
	ASSERT(dwVersion <span style=color:#f92672>&lt;=</span> _MFC_VER);
	UNUSED(dwVersion);  <span style=color:#75715e>// not used in release build
</span><span style=color:#75715e></span><span style=color:#75715e>#ifdef _AFXDLL
</span><span style=color:#75715e></span>	pModuleState<span style=color:#f92672>-&gt;</span>m_dwVersion <span style=color:#f92672>=</span> dwVersion;
<span style=color:#75715e>#endif
</span><span style=color:#75715e></span><span style=color:#f92672>:</span>
</code></pre></td></tr></table></div></div><p>_tWinMain()에서 호출하는 AfxWinMain()의 정의는 VC\atlmfc\src\mfc\winmain.cpp에서 확인할 수 있다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// This is a part of the Microsoft Foundation Classes C++ library.
</span><span style=color:#75715e>// Copyright (C) Microsoft Corporation
</span><span style=color:#75715e>// All rights reserved.
</span><span style=color:#75715e>//
</span><span style=color:#75715e>// This source code is only intended as a supplement to the
</span><span style=color:#75715e>// Microsoft Foundation Classes Reference and related
</span><span style=color:#75715e>// electronic documentation provided with the library.
</span><span style=color:#75715e>// See these sources for detailed information regarding the
</span><span style=color:#75715e>// Microsoft Foundation Classes product.
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;stdafx.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;sal.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>

<span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////
</span><span style=color:#75715e>// Standard WinMain implementation
</span><span style=color:#75715e>//  Can be replaced as long as &#39;AfxWinInit&#39; is called first
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> AFXAPI <span style=color:#a6e22e>AfxWinMain</span>(HINSTANCE hInstance, HINSTANCE hPrevInstance,
	_In_ LPTSTR lpCmdLine, <span style=color:#66d9ef>int</span> nCmdShow)
{
	ASSERT(hPrevInstance <span style=color:#f92672>==</span> NULL);

	<span style=color:#66d9ef>int</span> nReturnCode <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
	CWinThread<span style=color:#f92672>*</span> pThread <span style=color:#f92672>=</span> AfxGetThread();
<span style=display:block;width:100%;background-color:#3c3d38>	CWinApp<span style=color:#f92672>*</span> pApp <span style=color:#f92672>=</span> AfxGetApp();
</span>
	<span style=color:#75715e>// AFX internal initialization
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>AfxWinInit(hInstance, hPrevInstance, lpCmdLine, nCmdShow))
		<span style=color:#66d9ef>goto</span> InitFailure;

	<span style=color:#75715e>// App global initializations (rare)
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (pApp <span style=color:#f92672>!=</span> NULL <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>pApp<span style=color:#f92672>-&gt;</span>InitApplication())
		<span style=color:#66d9ef>goto</span> InitFailure;

	<span style=color:#75715e>// Perform specific initializations
</span><span style=display:block;width:100%;background-color:#3c3d38><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>pThread<span style=color:#f92672>-&gt;</span>InitInstance())
</span>	{
		<span style=color:#66d9ef>if</span> (pThread<span style=color:#f92672>-&gt;</span>m_pMainWnd <span style=color:#f92672>!=</span> NULL)
		{
			TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: Destroying non-NULL m_pMainWnd</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
			pThread<span style=color:#f92672>-&gt;</span>m_pMainWnd<span style=color:#f92672>-&gt;</span>DestroyWindow();
		}
		nReturnCode <span style=color:#f92672>=</span> pThread<span style=color:#f92672>-&gt;</span>ExitInstance();
		<span style=color:#66d9ef>goto</span> InitFailure;
	}
	nReturnCode <span style=color:#f92672>=</span> pThread<span style=color:#f92672>-&gt;</span>Run();

InitFailure:
<span style=color:#75715e>#ifdef _DEBUG
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Check for missing AfxLockTempMap calls
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (AfxGetModuleThreadState()<span style=color:#f92672>-&gt;</span>m_nTempMapLock <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>)
	{
		TRACE(traceAppMsg, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#34;Warning: Temp map lock count non-zero (%ld).</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,
			AfxGetModuleThreadState()<span style=color:#f92672>-&gt;</span>m_nTempMapLock);
	}
	AfxLockTempMaps();
	AfxUnlockTempMaps(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
<span style=color:#75715e>#endif
</span><span style=color:#75715e></span>
	AfxWinTerm();
	<span style=color:#66d9ef>return</span> nReturnCode;
}

<span style=color:#75715e>/////////////////////////////////////////////////////////////////////////////
</span></code></pre></td></tr></table></div></div><p><a href=https://docs.microsoft.com/en-us/cpp/mfc/reference/application-information-and-management#afxgetapp target=_blank rel="noopener noreffer">AfxGetApp()</a>를 통해 개발자가 정의한 Application 변수의 주소를 얻고, 해당 변수에서 <a href="https://docs.microsoft.com/en-us/cpp/mfc/reference/cwinapp-class?view=vs-2019#initinstance" target=_blank rel="noopener noreffer">InitInstance()</a> 메서드를 호출한다. 해당 함수는 개발자가 재정의할 수 있으며, 우리는 이 InitInstance()함수를 수정하여 MFC dialog를 띄우지 않고 콘솔에서 처리할 수 있도록 변형한 것이다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#f92672>:</span>
<span style=color:#75715e>// CConsoleGuiToolApp construction
</span><span style=color:#75715e></span>
CConsoleGuiToolApp<span style=color:#f92672>::</span>CConsoleGuiToolApp()
{
	<span style=color:#75715e>// TODO: add construction code here,
</span><span style=color:#75715e></span>	<span style=color:#75715e>// Place all significant initialization in InitInstance
</span><span style=color:#75715e></span>}


<span style=color:#75715e>// The one and only CConsoleGuiToolApp object
</span><span style=color:#75715e></span>
<span style=display:block;width:100%;background-color:#3c3d38>CConsoleGuiToolApp theApp;
</span>
<span style=color:#75715e>// CConsoleGuiToolApp initialization
</span><span style=color:#75715e></span>BOOL CConsoleGuiToolApp<span style=color:#f92672>::</span>InitInstance()
<span style=color:#f92672>:</span>
</code></pre></td></tr></table></div></div><h3 id=다른-gui-framework에서의-진입점-main-함수>다른 GUI framework에서의 진입점 (main 함수)</h3><p>아래는 각 C/C++로 작성된 GUI framework의 진입점이다. 대부분의 GUI framework는 main() 함수를 편집할 수 있다.</p><p>WxWidget은 MFC와 같이 main() 함수를 편집할 수 없으므로, <a href=https://wiki.wxwidgets.org/Command-Line_Arguments target=_blank rel="noopener noreffer">wxApp이 제공하는 메서드</a>를 사용해야 한다.</p><p>QT</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;QApplication&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;QCommandLineParser&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;QCommandLineOption&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;mainwindow.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[])
{
    Q_INIT_RESOURCE(application);

    QApplication app(argc, argv);
    QCoreApplication<span style=color:#f92672>::</span>setOrganizationName(<span style=color:#e6db74>&#34;QtProject&#34;</span>);
    QCoreApplication<span style=color:#f92672>::</span>setApplicationName(<span style=color:#e6db74>&#34;Application Example&#34;</span>);
    QCoreApplication<span style=color:#f92672>::</span>setApplicationVersion(QT_VERSION_STR);
    QCommandLineParser parser;
    parser.setApplicationDescription(QCoreApplication<span style=color:#f92672>::</span>applicationName());
    parser.addHelpOption();
    parser.addVersionOption();
    parser.addPositionalArgument(<span style=color:#e6db74>&#34;file&#34;</span>, <span style=color:#e6db74>&#34;The file to open.&#34;</span>);
    parser.process(app);

    MainWindow mainWin;
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>parser.positionalArguments().isEmpty())
        mainWin.loadFile(parser.positionalArguments().first());
    mainWin.show();
    <span style=color:#66d9ef>return</span> app.exec();
}
</code></pre></div><p>GTK+</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;gtk/gtk.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;gtk_app.h&#34;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span>
<span style=color:#a6e22e>main</span> (<span style=color:#66d9ef>int</span>    argc,
      <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv)
{
  GtkApplication <span style=color:#f92672>*</span>app;
  <span style=color:#66d9ef>int</span> status;

  app <span style=color:#f92672>=</span> gtk_application_new (<span style=color:#e6db74>&#34;org.gtk.example&#34;</span>, G_APPLICATION_FLAGS_NONE);
  g_signal_connect (app, <span style=color:#e6db74>&#34;activate&#34;</span>, G_CALLBACK (activate), NULL);
  status <span style=color:#f92672>=</span> g_application_run (G_APPLICATION (app), argc, argv);
  g_object_unref (app);

  <span style=color:#66d9ef>return</span> status;
}
</code></pre></div><p>FLTK</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;FL/Fl.H&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;FL/Fl_Window.H&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;FL/Fl_Button.H&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>argv[]) {
   Fl_Window<span style=color:#f92672>*</span> w <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Fl_Window(<span style=color:#ae81ff>330</span>, <span style=color:#ae81ff>190</span>);
   <span style=color:#66d9ef>new</span> Fl_Button(<span style=color:#ae81ff>110</span>, <span style=color:#ae81ff>130</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>35</span>, <span style=color:#e6db74>&#34;Okay&#34;</span>);
   w<span style=color:#f92672>-&gt;</span>end();
   w<span style=color:#f92672>-&gt;</span>show(argc, argv);
   <span style=color:#66d9ef>return</span> Fl<span style=color:#f92672>::</span>run();
}
</code></pre></div><h2 id=참고-링크>참고 링크</h2><p>[1] MFC 기본코드 분석(<a href=https://petra.tistory.com/1296 target=_blank rel="noopener noreffer">https://petra.tistory.com/1296</a>)</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>수정: 2020-09-14</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/mfc/>MFC</a>,&nbsp;<a href=/tags/gui/>GUI</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>뒤로</a></span>&nbsp;|&nbsp;<span><a href=/>홈</a></span></section></div><div class=post-nav><a href=/posts/project-whitecat/chap0-changing-home-network/ class=prev rel=prev title="Project Whitecat: 0. 집안 네트워크 뒤집어 놓기"><i class="fas fa-angle-left fa-fw"></i>Project Whitecat: 0. 집안 네트워크 뒤집어 놓기</a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.78.1">Hugo</a>로 제작된 사이트 | 테마 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="맨 위로"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="댓글 보기"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"복사하기","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"jsyoo5b/jsyoo5b.github.io"}}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-93278071-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-93278071-1" async></script></body></html>